<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é€²å‡ºç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-6">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-slate-800">é€²å‡ºç´€éŒ„ç®¡ç†ç³»çµ±</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="md:col-span-2 bg-white p-4 rounded-xl shadow-sm border">
                <h2 class="font-bold mb-3">ğŸ” æ™‚é–“ç¯©é¸</h2>
                <div class="flex gap-2 items-center">
                    <input type="date" id="startDate" class="border rounded p-2">
                    <span>è‡³</span>
                    <input type="date" id="endDate" class="border rounded p-2">
                    <button onclick="currentPage=1; loadData()" class="bg-indigo-600 text-white px-4 py-2 rounded">æŸ¥è©¢</button>
                    <button onclick="resetSearch()" class="text-gray-500 underline">é‡ç½®</button>
                </div>
            </div>

            <div class="bg-orange-50 p-4 rounded-xl border border-orange-200 shadow-sm">
                <h2 class="font-bold text-orange-700 mb-2">âš ï¸ ç›®å‰åœ¨å ´å…§äººå“¡</h2>
                <ul id="missingList" class="text-sm text-orange-800 list-disc pl-5">
                    </ul>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-800 text-white text-sm">
                    <tr>
                        <th class="p-4">äººå“¡åç¨±</th>
                        <th class="p-4">é€²å‡ºç‹€æ…‹</th>
                        <th class="p-4">æ™‚é–“</th>
                    </tr>
                </thead>
                <tbody id="dataTable" class="divide-y divide-slate-100"></tbody>
            </table>
            
            <div class="p-4 flex justify-between items-center bg-slate-50">
                <button onclick="changePage(-1)" id="prevBtn" class="bg-white border px-4 py-1 rounded shadow-sm disabled:opacity-50">ä¸Šä¸€é </button>
                <span id="pageInfo" class="text-sm font-medium">ç¬¬ 1 é </span>
                <button onclick="changePage(1)" id="nextBtn" class="bg-white border px-4 py-1 rounded shadow-sm">ä¸‹ä¸€é </button>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const API_BASE = window.location.origin; // è‡ªå‹•æŠ“å–ç•¶å‰ç¶²å€

        async function loadData() {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            const url = `${API_BASE}/data?page=${currentPage}&start=${start}&end=${end}`;
            
            const res = await fetch(url);
            const data = await res.json();
            
            const tbody = document.getElementById('dataTable');
            tbody.innerHTML = data.length ? "" : "<tr><td colspan='3' class='p-10 text-center text-gray-400'>æ²’æœ‰æ›´å¤šè³‡æ–™äº†</td></tr>";
            
            data.forEach(item => {
                const badge = item.inorout ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50">
                        <td class="p-4 font-bold">${item.member}</td>
                        <td class="p-4"><span class="px-2 py-1 rounded-full text-xs font-bold ${badge}">${item.inorout ? 'é€²å…¥' : 'å‡ºä¾†'}</span></td>
                        <td class="p-4 text-slate-500 text-sm">${item.time}</td>
                    </tr>`;
            });
            document.getElementById('pageInfo').innerText = `ç¬¬ ${currentPage} é `;
            document.getElementById('prevBtn').disabled = (currentPage === 1);
            document.getElementById('nextBtn').disabled = (data.length < 10);
        }

        async function loadMissing() {
            const res = await fetch(`${API_BASE}/missing`);
            const data = await res.json();
            const list = document.getElementById('missingList');
            list.innerHTML = data.length ? data.map(name => `<li>${name}</li>`).join('') : "<li>æ‰€æœ‰äººçš†å·²é›¢é–‹</li>";
        }

        function changePage(step) {
            currentPage += step;
            loadData();
        }

        function resetSearch() {
            document.getElementById('startDate').value = "";
            document.getElementById('endDate').value = "";
            currentPage = 1;
            loadData();
        }

        loadData();
        loadMissing();
    </script>
</body>
</html>

